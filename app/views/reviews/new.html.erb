<div class="container">
  <%# 言語切り替えボタン %>
  <div class="row justify-content-center mb-3">
    <div class="col-lg-8 d-flex justify-content-end">
      <%= render 'shared/language_switcher' %>
    </div>
  </div>

  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow-sm">
        <div class="card-body p-4">
          <%# ヘッダー部分 %>
          <div class="text-center mb-4">
            <h2 class="h3 mb-3"><%= @shop.name %></h2>
            <p class="text-muted">
              <%= t('.thank_you') %><br>
              <%= t('.feedback_request') %>
            </p>
          </div>

          <%# エラーメッセージ %>
          <% if @review.errors.any? %>
            <div class="alert alert-danger" role="alert">
              <h5 class="alert-heading mb-2">
                <%= t('.error_count', count: @review.errors.count) %>
              </h5>
              <ul class="mb-0">
                <% @review.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <%= turbo_frame_tag "review_form", target: "_top" do %>
            <%= form_with(model: [@shop, @review], 
              url: shop_reviews_path(@shop, locale: params[:locale]),
              local: true,
              data: { turbo: false }) do |form| %>
              <%# 評価 %>
              <div class="mb-4">
                <label class="form-label d-block">
                  <%= t('.rating') %>
                  <span class="text-danger">*</span>
                </label>
                <div data-controller="star-rating" class="text-center">
                  <%= form.hidden_field :score, 
                      data: { star_rating_target: "input" },
                      required: true %>
                  <div class="star-rating" role="group" aria-label="<%= t('.rating') %>">
                    <% 5.times do |i| %>
                      <span
                        class="star empty"
                        data-star-rating-target="star"
                        data-value="<%= i + 1 %>"
                        data-action="click->star-rating#setValue mouseenter->star-rating#preview mouseleave->star-rating#clearPreview"
                        role="button"
                        tabindex="0">
                        ★
                      </span>
                    <% end %>
                  </div>
                  <small class="text-muted d-block mt-2"><%= t('.rating_instruction') %></small>
                </div>
              </div>

              <%# コメント %>
              <div class="mb-4">
                <label class="form-label">
                  <%= t('.comments') %>
                  <span class="text-danger">*</span>
                </label>
                <%= form.text_area :comments, 
                    class: "form-control",
                    rows: 5,
                    required: true,
                    placeholder: t('.comments_placeholder') %>
                <div class="form-text"><%= t('.comments_example') %></div>
              </div>

              <%# 送信ボタン %>
              <div class="text-center mt-4">
                <%= form.submit t('.submit_button'),
                    class: "btn btn-primary btn-lg px-5",
                    data: { disable_with: t('.submitting') } %>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>


<style>
.star {
  font-size: 40px;
  color: #D1D5DB;
  cursor: pointer;
  transition: all 0.2s ease;
  display: inline-block;
  user-select: none;
}

.star:hover {
  transform: scale(1.2);
}

.star.filled {
  color: #FFC107 !important;
  text-shadow: 0 0 15px rgba(255, 193, 7, 0.5);
}

.star.preview {
  color: #FFC107 !important;
  text-shadow: 0 0 15px rgba(255, 193, 7, 0.5);
}

.star-rating {
  display: inline-flex;
  gap: 12

</style>