<h2><%= @shop.name %>レビュー</h1>

<div class="mt-1">
  <small class="text-muted">
    <div>
      総レビュー数: <b><%= @reviews.count %>件</b>
    </div>

    <div>
      平均評価: <b><%= @reviews.average(:score)&.round(1) || 0 %></b>
    </div>
  </small>
</div>

<div class="card">
  <div class="card-body">
    <div>
      <%= line_chart(
        @monthly_data[0][:data],
        ytitle: "総レビュー数",
        messages: {empty: "データがありません"},
        thousands: ",",
        suffix: "件",
        min: 0,
        colors: ["#76B852"],
        curve: true,
        library: {
          scales: {
            x: {
              display: false  # X軸のラベルを非表示
            },
            y: {
              beginAtZero: true
            }
          },
          elements: {
            line: {
              tension: 0.4
            }
          },
          plugins: {
            title: {
              display: false,
              text: '総レビュー数推移'
            }
          },
          fill: {
            target: 'origin',
            above: 'rgba(118, 184, 82, 0.2)'
          }
        }
      ) %>
    </div>

    <div>
      <%= column_chart(
        @monthly_data[1][:data],
        ytitle: "月別レビュー数",
        messages: {empty: "データがありません"},
        thousands: ",",
        suffix: "件",
        min: 0,
        colors: ["#4BC0C0"],
        library: {
          scales: {
            y: {
              beginAtZero: true
            }
          },
          plugins: {
            title: {
              display: false,
              text: '月別レビュー数'
            }
          }
        }
      ) %>
    </div>
  </div>
</div>

<!-- レビュー一覧部分 -->
<table class="table table-hover mt-4">
  <thead>
    <tr>
      <th>評価</th>
      <th>コメント</th>
      <th>投稿日</th>
    </tr>
  </thead>
  <tbody>
    <% @paginated_reviews.each do |review| %>
      <tr>
        <td><span class="review-stars"><%= "★" * review.score %><span class="text-muted"><%= "★" * (5 - review.score) %></span></span></td>
        <td><%= review.comments %></td>
        <td><%= review.created_at.in_time_zone('Tokyo').strftime('%Y年%m月%d日 %H:%M') %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<!-- ページネーション -->
<div class="d-flex justify-content-center">
  <%= paginate @paginated_reviews %>
</div>

<div class="mt-4">
  <%= link_to '店舗情報に戻る', shop_path(@shop), class: 'btn btn-secondary' %>
</div>


<style>
/* 評価入力用の星のスタイル（既存のまま） */
.star {
  font-size: 36px;
  color: #D1D5DB;
  cursor: pointer;
  transition: transform 0.2s ease;
  display: inline-block;
}

.star:hover {
  transform: scale(1.2);
}

.star.filled {
  color: #FFD700 !important;
}

.star.preview {
  color: #FFD700 !important;
}

.star-rating {
  display: inline-flex;
  gap: 8px;
}

/* レビュー一覧用の星のスタイル */
.review-stars {
  color: #FFD700;
  font-size: 17px;
  letter-spacing: 2px;
}

/* 選択されていない星のスタイル - より薄いグレーに */
.review-stars .text-muted {
  color: #E5E7EB !important;  /* さらに薄い灰色に変更 */
}
</style>