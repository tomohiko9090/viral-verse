# æš«å®šãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †
1. ssh -i ~/.ssh/kuchikomi-elevator.pem ec2-user@57.182.63.187
2. cd /var/www/kuchikomi-elevator
3. git pull origin main
4. ä»¥ä¸‹å®Ÿè¡Œ
```
RAILS_ENV=production bundle exec rails assets:clean
RAILS_ENV=production bundle exec rails assets:clobber
RAILS_ENV=production bundle exec rails assets:precompile
kill -QUIT `cat tmp/pids/unicorn.pid`
RAILS_ENV=production bundle exec unicorn_rails -c config/unicorn.rb -E production -D
```

# ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã¨æ©Ÿèƒ½ã‚¢ã‚¯ã‚»ã‚¹

| ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ | åˆ©ç”¨è€… | ã‚¢ã‚¯ã‚»ã‚¹ç¯„å›² | ShopsController | ReviewsController |
|-------------|------------|------------|-----------------|-------------------|
| admin       | é–‹ç™ºè€…ãƒ»é‹ç”¨è€… | ã™ã¹ã¦ã®ãŠåº— | ã™ã¹ã¦            | ã™ã¹ã¦              |
| owner       | ã‚ªãƒ¼ãƒŠãƒ¼ãƒ»åº—é•·ãƒ»åº—å“¡ | ç‰¹å®šã®ãŠåº—   | show, edit, update | ã™ã¹ã¦              |
| multipul_owner | ã‚¨ãƒªã‚¢ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ | ç‰¹å®šã®è¤‡æ•°ã®ãŠåº—   | show, edit, update | ã™ã¹ã¦              |
| customer    | ãŠåº—ã«æ¥ãŸãŠå®¢ã•ã‚“ | ç‰¹å®šã®ãŠåº—   | ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯           | new, create, notice |

# æ¨©é™åˆ¥URLã‚¢ã‚¯ã‚»ã‚¹å¯å¦ä¸€è¦§è¡¨

## å‡¡ä¾‹
- âœ… - ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- âŒ - ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
- ğŸ”„ - æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼ˆè‡ªåˆ†ã®åº—èˆ—ã®ã¿ãªã©ï¼‰

## æ¨©é™èª¬æ˜
1. **admin**: ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…
2. **owner**: é€šå¸¸ã‚ªãƒ¼ãƒŠãƒ¼ï¼ˆ1åº—èˆ—ã®ã¿ï¼‰
3. **multipul_owner**: è¤‡æ•°åº—èˆ—ã‚ªãƒ¼ãƒŠãƒ¼ï¼ˆè¤‡æ•°åº—èˆ—ï¼‰
4. **customer**: ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­”è€…

## ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™è¡¨

# æ¨©é™åˆ¥URLã‚¢ã‚¯ã‚»ã‚¹å¯å¦ä¸€è¦§è¡¨

## å‡¡ä¾‹
- âœ… - ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- âŒ - ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
- ğŸ”„ - æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼ˆè‡ªåˆ†ã®åº—èˆ—ã®ã¿ãªã©ï¼‰

## æ¨©é™èª¬æ˜
1. **admin**: ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…
2. **owner**: é€šå¸¸ã‚ªãƒ¼ãƒŠãƒ¼ï¼ˆ1åº—èˆ—ã®ã¿ï¼‰
3. **multipul_owner**: è¤‡æ•°åº—èˆ—ã‚ªãƒ¼ãƒŠãƒ¼ï¼ˆè¤‡æ•°åº—èˆ—ï¼‰
4. **customer**: ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­”è€…

## ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™è¡¨

| URL | ç”»é¢ãƒ»æ©Ÿèƒ½ã®èª¬æ˜ | admin | owner | multipul_owner | customer |
|-----|---------------|-------|-------|----------------|----------|
| **ã‚»ãƒƒã‚·ãƒ§ãƒ³é–¢é€£** |
| GET /login | ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ | âœ… | âœ… | âœ… | âœ… |
| POST /login | ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç† | âœ… | âœ… | âœ… | âœ… |
| DELETE /logout | ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç† | âœ… | âœ… | âœ… | âŒ |
| **åº—èˆ—é–¢é€£** |
| GET / (root) | ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ï¼ˆåº—èˆ—ä¸€è¦§ï¼‰ | âœ… | âœ… | âœ… | âŒ |
| GET /shops | åº—èˆ—ä¸€è¦§ç”»é¢ | âœ… | âœ… | âœ… | âŒ |
| GET /shops/new | æ–°è¦åº—èˆ—ç™»éŒ²ç”»é¢ | âœ… | âŒ | âŒ | âŒ |
| POST /shops | åº—èˆ—ç™»éŒ²å‡¦ç† | âœ… | âŒ | âŒ | âŒ |
| GET /shops/:id | åº—èˆ—è©³ç´°ç”»é¢ | âœ… | ğŸ”„ | ğŸ”„ | âŒ |
| GET /shops/:id/edit | åº—èˆ—æƒ…å ±ç·¨é›†ç”»é¢ | âœ… | âŒ | âŒ | âŒ |
| PATCH/PUT /shops/:id | åº—èˆ—æƒ…å ±æ›´æ–°å‡¦ç† | âœ… | âŒ | âŒ | âŒ |
| DELETE /shops/:id | åº—èˆ—å‰Šé™¤å‡¦ç† | âœ… | âŒ | âŒ | âŒ |
| **ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£** |
| GET /shops/:id/users/new | æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ç”»é¢ | âœ… | âŒ | âŒ | âŒ |
| POST /shops/:id/users | ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²å‡¦ç† | âœ… | âŒ | âŒ | âŒ |
| GET /shops/:id/users/:user_id/edit | ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ç·¨é›†ç”»é¢ | âœ… | âŒ | âŒ | âŒ |
| PATCH/PUT /shops/:id/users/:user_id | ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±æ›´æ–°å‡¦ç† | âœ… | âŒ | âŒ | âŒ |
| DELETE /shops/:id/users/:user_id | ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤å‡¦ç† | âœ… | âŒ | âŒ | âŒ |
| **ãƒ¬ãƒ“ãƒ¥ãƒ¼é–¢é€£** |
| GET /shops/:id/reviews | ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸€è¦§ãƒ»åˆ†æç”»é¢ | âœ… | ğŸ”„ | ğŸ”„ | âŒ |
| GET /shops/:id/reviews/new | ãƒ¬ãƒ“ãƒ¥ãƒ¼å…¥åŠ›ç”»é¢ | âœ… | âœ… | âœ… | âœ… |
| GET /shops/:id/reviews/new/:locale | å¤šè¨€èªãƒ¬ãƒ“ãƒ¥ãƒ¼å…¥åŠ›ç”»é¢ | âœ… | âœ… | âœ… | âœ… |
| POST /shops/:id/reviews | ãƒ¬ãƒ“ãƒ¥ãƒ¼é€ä¿¡å‡¦ç† | âœ… | âœ… | âœ… | âœ… |
| GET /shops/:id/reviews/:review_id/notice | ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†ãƒ»ãŠç¤¼ç”»é¢ | âœ… | âœ… | âœ… | âœ… |
| GET /shops/:id/reviews/:review_id/survey1 | ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ1ç”»é¢ï¼ˆä½è©•ä¾¡æ™‚ï¼‰ | âœ… | âœ… | âœ… | âœ… |
| GET /shops/:id/reviews/:review_id/survey2 | ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ2ç”»é¢ï¼ˆä½è©•ä¾¡æ™‚ï¼‰ | âœ… | âœ… | âœ… | âœ… |
| POST /shops/:id/reviews/:review_id/submit_survey1 | ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ1é€ä¿¡å‡¦ç† | âœ… | âœ… | âœ… | âœ… |
| POST /shops/:id/reviews/:review_id/submit_survey2 | ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ2é€ä¿¡å‡¦ç† | âœ… | âœ… | âœ… | âœ… |

## è£œè¶³èª¬æ˜

1. **adminï¼ˆã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ï¼‰**
   - ã™ã¹ã¦ã®URLã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
   - åº—èˆ—ã®ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ãŒå¯èƒ½
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ãŒå¯èƒ½
   - ã™ã¹ã¦ã®åº—èˆ—ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’é–²è¦§å¯èƒ½

2. **ownerï¼ˆé€šå¸¸ã‚ªãƒ¼ãƒŠãƒ¼ï¼‰**
   - è‡ªåˆ†ã®åº—èˆ—ã®è©³ç´°ãƒšãƒ¼ã‚¸ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
   - è‡ªåˆ†ã®åº—èˆ—ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸€è¦§ã®ã¿é–²è¦§å¯èƒ½
   - åº—èˆ—ã®ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã¯ä¸å¯
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã¯ä¸å¯

3. **multipul_ownerï¼ˆè¤‡æ•°åº—èˆ—ã‚ªãƒ¼ãƒŠãƒ¼ï¼‰**
   - è‡ªåˆ†ã«ç´ã¥ãåº—èˆ—ã®è©³ç´°ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
   - è‡ªåˆ†ã«ç´ã¥ãåº—èˆ—ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸€è¦§ã‚’é–²è¦§å¯èƒ½
   - åº—èˆ—ã®ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã¯ä¸å¯
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã¯ä¸å¯

4. **customerï¼ˆã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­”è€…ï¼‰**
   - ãƒ¬ãƒ“ãƒ¥ãƒ¼é–¢é€£ã®URLã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
   - ãƒ­ã‚°ã‚¤ãƒ³ä¸è¦ã®ãƒšãƒ¼ã‚¸ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
   - åº—èˆ—æƒ…å ±ã‚„ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®é–²è¦§ã¯ä¸å¯

## ã‚ˆãã‚ã‚‹è³ªå•

**Q1: ã‚ªãƒ¼ãƒŠãƒ¼ã¯è‡ªåˆ†ã®åº—èˆ—ä»¥å¤–ã®æƒ…å ±ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã‹ï¼Ÿ**
A1: ã„ã„ãˆã€ã‚ªãƒ¼ãƒŠãƒ¼ã¯è‡ªåˆ†ã«ç´ã¥ã„ã¦ã„ã‚‹åº—èˆ—ã®æƒ…å ±ã®ã¿é–²è¦§ã§ãã¾ã™ã€‚

**Q2: ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒšãƒ¼ã‚¸ã¯èª°ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã‹ï¼Ÿ**
A2: ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æ–°è¦ä½œæˆã‚„å›ç­”ãƒšãƒ¼ã‚¸ã¯èª°ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ãŒã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸€è¦§ã®é–²è¦§ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚

**Q3: è¤‡æ•°åº—èˆ—ã‚ªãƒ¼ãƒŠãƒ¼ã¨é€šå¸¸ã‚ªãƒ¼ãƒŠãƒ¼ã®é•ã„ã¯ä½•ã§ã™ã‹ï¼Ÿ**
A3: ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹æ¨©é™ã¯åŒã˜ã§ã™ãŒã€è¤‡æ•°åº—èˆ—ã‚ªãƒ¼ãƒŠãƒ¼ã¯è¤‡æ•°ã®åº—èˆ—æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

**Q4: ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã®ã¿ãŒã§ãã‚‹æ“ä½œã¯ä½•ã§ã™ã‹ï¼Ÿ**
A4: åº—èˆ—ã®ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç®¡ç†ï¼ˆä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ï¼‰ã¯ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã®ã¿ãŒå¯èƒ½ã§ã™ã€‚

# DB
https://drawsql.app/teams/--109/diagrams/kuchikomi-elevator-2

# ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
```mermaid
flowchart TD
    qr(QRã‚³ãƒ¼ãƒ‰è¡¨ç¤º) --> |fa:fa-user ã‚¹ãƒãƒ›ã§èª­ã¿ã¨ã‚‹|review[è©•ä¾¡ãƒšãƒ¼ã‚¸ã«é·ç§»]
    review --> |fa:fa-user å›ç­”ã™ã‚‹|branch{ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯å¾Œã€â˜…ã®æ•°ã§åˆ†å²}

    branch -->|1~3å€‹ã®å ´åˆ| survey1[æ”¹å–„ç‚¹ã«ã¤ã„ã¦ã®ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ]
    branch -->|4,5å€‹ã®å ´åˆ| copy[ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™!ã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã‚³ãƒ”ãƒ¼]

    survey1 --> |fa:fa-user å›ç­”ã™ã‚‹|survey2[ã‚µãƒ¼ãƒ“ã‚¹æ”¹å–„ã®ã”ææ¡ˆã«ã¤ã„ã¦ã®ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ]
    survey2 -->|fa:fa-user å›ç­”ã™ã‚‹|thanks[ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ]
    
    copy --> Google
    thanks -->Google(Googleå£ã‚³ãƒŸç”»é¢ã«é·ç§»)
```

# è¨­è¨ˆæ–¹é‡
- enum
  - æ¨©é™
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒƒã‚·ãƒ¥
  - è¨€èªè¨­å®š
- ãƒ†ãƒ¼ãƒ–ãƒ«ç®¡ç†ã€ç¸¦æŒã¡
  - æ¥­ç•Œ
- ã‚«ãƒ©ãƒ è¿½åŠ ã€æ¨ªæŒã¡
  - ãŠåº—å
- i18n
  - ã„ã‚ã‚“ãªãƒšãƒ¼ã‚¸ã®æ–‡è¨€
- å®šæ•°

 
# AWS ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ææ¡ˆï¼ˆã‚³ã‚¹ãƒˆé †ï¼‰
1ãƒ¶æœˆã€1æ—¥300ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å ´åˆã‚’æƒ³å®š

## 1. æœ€å°ã‚³ã‚¹ãƒˆæ§‹æˆ
Route 53 â†’ EC2 (t3.micro) [ã‚¹ãƒãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹] â†’ MySQL(EC2å†…) â†’ S3
Copy- **æœˆé¡ã‚³ã‚¹ãƒˆï¼šç´„Â¥900ï¼ˆ$6ï¼‰**
- **ä¸»ãªç”¨é€”ï¼šé–‹ç™ºåˆæœŸã€MVPã€å°è¦æ¨¡é‹ç”¨**
### ç‰¹å¾´
- EC2å†…ã«MySQLã‚’ç›´æ¥ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- ã‚¹ãƒãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚ˆã‚‹ã‚³ã‚¹ãƒˆå‰Šæ¸›
- ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆã§ç®¡ç†ãŒå®¹æ˜“
### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- DBã®å†—é•·æ€§ãªã—
- ã‚¹ãƒãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ä¸­æ–­ã®å¯èƒ½æ€§ã‚ã‚Š
- ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã¯æ‰‹å‹•

â†’ S3ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã‚‹ã“ã¨ã‚‚å¯èƒ½

## 2. æ¨™æº–æ§‹æˆï¼ˆEC2 + RDSï¼‰
Route 53 â†’ EC2 (t3.micro) â†’ RDS (t3.micro) â†’ S3
Copy- **æœˆé¡ã‚³ã‚¹ãƒˆï¼šç´„Â¥3,750ï¼ˆ$25ï¼‰**
- **ä¸»ãªç”¨é€”ï¼šå°ï½ä¸­è¦æ¨¡ã®ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒ**
### ç‰¹å¾´
- RDSã«ã‚ˆã‚‹å …ç‰¢ãªDBé‹ç”¨
- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©å…ƒãŒå®¹æ˜“
- ç®¡ç†ãŒæ¯”è¼ƒçš„å®¹æ˜“
### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- ã‚³ã‚¹ãƒˆãŒä¸­ç¨‹åº¦
- ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã¯æ‰‹å‹•
- é‹ç”¨ç®¡ç†ã®å·¥æ•°ãŒå¿…è¦

## 3. ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹æ§‹æˆ
Route 53 â†’ API Gateway â†’ Lambda â†’ Aurora Serverless v2 â†’ S3
Copy- **æœˆé¡ã‚³ã‚¹ãƒˆï¼šç´„Â¥6,150ï¼ˆ$41ï¼‰**
- **ä¸»ãªç”¨é€”ï¼šå¤‰å‹•ã®å¤§ãã„ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã€é‹ç”¨å·¥æ•°ã‚’æœ€å°åŒ–ã—ãŸã„å ´åˆ**
### ç‰¹å¾´
- ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ä¸è¦
- è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
- é«˜å¯ç”¨æ€§
### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- æœ€ã‚‚ã‚³ã‚¹ãƒˆãŒé«˜ã„
- åˆæœŸæ§‹ç¯‰ãŒè¤‡é›‘
- ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆã®å•é¡Œ

## é¸å®šã®æŒ‡é‡
1. **é–‹ç™ºåˆæœŸãƒ»æ¤œè¨¼ãƒ•ã‚§ãƒ¼ã‚º**
   - æœ€å°ã‚³ã‚¹ãƒˆæ§‹æˆã‚’æ¨å¥¨
   - ã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆãªãŒã‚‰æ©Ÿèƒ½æ¤œè¨¼ãŒå¯èƒ½

2. **æœ¬ç•ªé‹ç”¨é–‹å§‹æ™‚**
   - æ¨™æº–æ§‹æˆã¸ã®ç§»è¡Œã‚’æ¤œè¨
   - ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šæ€§ã¨é‹ç”¨ã®å®‰å®šæ€§ã‚’ç¢ºä¿

3. **ã‚¹ã‚±ãƒ¼ãƒ«æ™‚ãƒ»é‹ç”¨åŠ¹ç‡åŒ–æ™‚**
   - ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹æ§‹æˆã¸ã®ç§»è¡Œã‚’æ¤œè¨
   - ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯å¤‰å‹•ã¸ã®å¯¾å¿œã¨é‹ç”¨è² è·ã®è»½æ¸›

## æ³¨æ„ç‚¹
- ã™ã¹ã¦ã®æ§‹æˆã§ã€AWSç„¡æ–™æ ã®æ´»ç”¨ãŒå¯èƒ½
- ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯å¢—åŠ ã«å¿œã˜ã¦ã€ä¸Šä½æ§‹æˆã¸ã®ç§»è¡Œã‚’æ¤œè¨
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¯å…¨æ§‹æˆã§è€ƒæ…®ãŒå¿…è¦


# DBãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥
## EBSã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®šæ‰‹é †

	1.	AWSãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ï¼š
	â€¢	AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ã€ã€ŒEC2ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹ãã¾ã™ã€‚
	2.	ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®è¨­å®šï¼š
	â€¢	EC2ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Œãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼ˆLifecycle Managerï¼‰ã€ã‚’é¸æŠã—ã¾ã™ã€‚
	3.	ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼ã®ä½œæˆï¼š
	â€¢	ã€Œãƒãƒªã‚·ãƒ¼ã®ä½œæˆï¼ˆCreate Lifecycle Policyï¼‰ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
	4.	ãƒãƒªã‚·ãƒ¼ã®è¨­å®šï¼š
	â€¢	ä»¥ä¸‹ã®é …ç›®ã‚’è¨­å®šã—ã¾ã™ã€‚
	â€¢	ãƒãƒªã‚·ãƒ¼ã‚¿ã‚¤ãƒ—ï¼šEBSã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’é¸æŠã—ã¾ã™ã€‚
	â€¢	ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ï¼šãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã‚ŠãŸã„EBSãƒœãƒªãƒ¥ãƒ¼ãƒ ã®ã‚¿ã‚¤ãƒ—ã‚’é¸ã³ã¾ã™ã€‚
	â€¢	ã‚¿ã‚°ï¼šç‰¹å®šã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ã ã‘ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ãŸã„å ´åˆã€ã‚¿ã‚°ã‚’æŒ‡å®šã—ã¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚
	5.	ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¨­å®šï¼š
	â€¢	ã€Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ä»¥ä¸‹ã®å†…å®¹ã‚’è¨­å®šã—ã¾ã™ã€‚
	â€¢	é »åº¦ï¼šæ¯æ—¥ã‚’é¸æŠã€‚
	â€¢	é–‹å§‹æ™‚é–“ï¼šãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã‚ŠãŸã„æ™‚é–“ã‚’æŒ‡å®šï¼ˆãŸã¨ãˆã°æ¯æ—¥æ·±å¤œ2æ™‚ãªã©ï¼‰ã€‚
	â€¢	ä¿æŒæœŸé–“ï¼šãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½•æ—¥åˆ†ä¿æŒã™ã‚‹ã‹ã‚’æŒ‡å®šã—ã¾ã™ï¼ˆä¾‹ãˆã°30æ—¥åˆ†ä¿æŒãªã©ï¼‰ã€‚
	6.	ãƒãƒªã‚·ãƒ¼ã‚’æœ‰åŠ¹åŒ–ï¼š
	â€¢	è¨­å®šã‚’ç¢ºèªã—ã€ã€Œãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆï¼ˆCreate Policyï¼‰ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å®Œäº†ã§ã™ã€‚

## æ¯æ—¥è‡ªå‹•ã§EBSã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’å–ã‚‹æ‰‹é †
	1.	AWSãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ï¼š
	â€¢	AWSã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ã€ã€ŒEC2ã€ã‚µãƒ¼ãƒ“ã‚¹ã«ç§»å‹•ã—ã¾ã™ã€‚
	2.	Data Lifecycle Managerã®è¨­å®šãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ï¼š
	â€¢	å·¦ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã€Œãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼ˆLifecycle Managerï¼‰ã€ã‚’é¸æŠã—ã¾ã™ã€‚
	3.	ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼ã®ä½œæˆï¼š
	â€¢	ã€Œãƒãƒªã‚·ãƒ¼ã®ä½œæˆï¼ˆCreate lifecycle policyï¼‰ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
	4.	ãƒãƒªã‚·ãƒ¼ã®è¨­å®šï¼š
	â€¢	ãƒãƒªã‚·ãƒ¼ã®å†…å®¹ã‚’è¨­å®šã—ã¦ã„ãã¾ã™ã€‚
	â€¢	ãƒãƒªã‚·ãƒ¼ã‚¿ã‚¤ãƒ—ï¼šEBSã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’é¸æŠã€‚
	â€¢	ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ï¼šãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’é¸æŠã€‚
	â€¢	ã‚¿ã‚°æŒ‡å®šï¼šç‰¹å®šã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ã ã‘ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ãŸã„å ´åˆã¯ã€è©²å½“ã™ã‚‹ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®ã‚¿ã‚°ã‚’æŒ‡å®šã—ã¾ã™ã€‚
	5.	ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¨­å®šï¼š
	â€¢	ã€Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¨­å®šã—ã¾ã™ã€‚
	â€¢	é »åº¦ï¼šæ¯æ—¥ã‚’é¸æŠã€‚
	â€¢	é–‹å§‹æ™‚é–“ï¼šãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®å®Ÿè¡Œæ™‚é–“ã‚’æŒ‡å®šã—ã¾ã™ï¼ˆä¾‹ï¼šæ·±å¤œ2æ™‚ï¼‰ã€‚
	â€¢	ä¿æŒæœŸé–“ï¼šã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä½•æ—¥é–“ä¿å­˜ã™ã‚‹ã‹è¨­å®šã—ã¾ã™ï¼ˆä¾‹ï¼š30æ—¥ï¼‰ã€‚
	6.	ãƒãƒªã‚·ãƒ¼ã®æœ‰åŠ¹åŒ–ï¼š
	â€¢	è¨­å®šå†…å®¹ã‚’ç¢ºèªã—ã€ã€Œãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å®Œäº†ã§ã™ã€‚


# ä»–ã®é–‹ç™ºè€…ãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¨­å®šã™ã‚‹éš›ã®è¨­å®š
```shell
# ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone [ãƒªãƒã‚¸ãƒˆãƒªURL]

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå]

# .env.exampleã‚’.envã«ã‚³ãƒ”ãƒ¼
cp ./.env.example ./.env

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
bundle install

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
bin/rails db:create
bin/rails db:migrate
```


# ãƒ­ã‚°
## Unicornã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
tail -f /var/www/kuchikomi-elevator/log/unicorn.stderr.log

## Unicornã®æ¨™æº–å‡ºåŠ›ãƒ­ã‚°ã‚’ç¢ºèª
tail -f /var/www/kuchikomi-elevator/log/unicorn.stdout.log

## Railsã®ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã‚’ç¢ºèª
tail -f /var/www/kuchikomi-elevator/log/production.log

## ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã‚‚ç¢ºèª
sudo tail -f /var/log/messages

## Nginxã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
sudo tail -f /var/log/nginx/error.log

## ãƒ•ãƒ­ãƒ³ãƒˆèª­ã¿è¾¼ã¿
- app/javascript/application.js
  - èµ·ç‚¹ã¨ãªã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
- app/javascript/controllers/index.js
  - èª­ã¿è¾¼ã‚€ãƒ•ã‚¡ã‚¤ãƒ«
- config/importmap.rb
  - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã©ã“ã‹ã‚‰èª­ã¿è¾¼ã‚€ã‹ã‚’å®šç¾©ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
  - pin "application" ã¨æ›¸ãã¨ã€app/javascript/application.jsã‚’èª­ã¿è¾¼ã‚ã‚‹ã‚ˆã†ã«ãªã‚‹
- app/javascript/controllers/application.js
	- Stimulusã®Applicationã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆãƒ»è¨­å®š
	- ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ä½¿ãˆã‚‹ã‚ˆã†export
	- ãƒ‡ãƒãƒƒã‚°è¨­å®šãªã©ã‚‚è¡Œã†


```mermaid
graph TD
    A[importmap.rb] -->|1. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒãƒƒãƒ”ãƒ³ã‚°| B[application.js]
    B -->|2. controllersèª­ã¿è¾¼ã¿| C[controllers/index.js]
    C -->|3. StimulusåˆæœŸåŒ–| D[controllers/application.js]
    D -->|4. Stimulusã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æä¾›| C
```

```
<script type="importmap">
ã«ã‚ã‚‹é †ç•ªã§
curl -k https://57.182.63.187/shops/1/reviews/new
ã®é †ç•ªã§èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã
```

- JSã‚„CSSã®å¤‰æ›´ â†’ ã‚¢ã‚»ãƒƒãƒˆé–¢é€£ã‚³ãƒãƒ³ãƒ‰ã¨Unicornã®å†èµ·å‹•
```
RAILS_ENV=production bundle exec rails assets:clean    # å¤ã„ã‚¢ã‚»ãƒƒãƒˆã‚’å‰Šé™¤
RAILS_ENV=production bundle exec rails assets:clobber  # ã‚¢ã‚»ãƒƒãƒˆã‚’å®Œå…¨ã«å‰Šé™¤
RAILS_ENV=production bundle exec rails assets:precompile # ã‚¢ã‚»ãƒƒãƒˆã‚’å†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
```
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ â†’ Unicornã®å†èµ·å‹•ã®ã¿
	- ex.mainãƒ–ãƒ©ãƒ³ãƒã‚’pullã—ãŸå¾Œã‚„Unicornã®è¨­å®šã‚’å¤§ããå¤‰æ›´ã—ãŸæ™‚
```
kill -QUIT `cat tmp/pids/unicorn.pid` && \
RAILS_ENV=production bundle exec unicorn_rails -c config/unicron.rb -E production -D
```
- Nginxè¨­å®šã®å¤‰æ›´ â†’ Nginxã®å†èµ·å‹•ã®ã¿
	- ex./etc/nginx/conf.d/rails.conf ãªã©ã®Nginxè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ãŸæ™‚
```
sudo systemctl restart nginx
```

export DB_USERNAME=root
export DB_PASSWORD=Katasutorohu2@
export PROD_DB_NAME=kuchikomi_elevator_production
export PROD_DB_USERNAME=root
export PROD_DB_PASSWORD='dGjl;6w>aHs%'
export PROD_DB_SOCKET=/var/lib/mysql/mysql.sock
export SECRET_KEY_BASE="eaf7d4fb636a6e8bfd0603c602118fbf06679875344531686319a4c881a26ee89463095fd1f9190f8f2eb08fe9d890e51f2207d07e3fe2379e7d7bc4a8c5694e"
export RAILS_ENV=production
export BUNDLE_GEMFILE=/var/www/kuchikomi-elevator/Gemfile


âŒ˜ + D  ãƒšã‚¤ãƒ³ã‚’æ¨ªã«åˆ†å‰²ã™ã‚‹
âŒ˜ + Shift + D	 ãƒšã‚¤ãƒ³ã‚’ç¸¦ã«åˆ†å‰²ã™ã‚‹
